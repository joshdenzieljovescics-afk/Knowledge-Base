<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/142.0.0.0 Safari/537.36" version="29.1.1">
  <diagram name="Document Upload Flow" id="document-upload-flow">
    <mxGraphModel dx="1389" dy="703" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" value="Document Upload Flow - System Sequence Diagram" vertex="1">
          <mxGeometry height="30" width="600" x="400" y="20" as="geometry" />
        </mxCell>
        <mxCell id="user" parent="1" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" value="User" vertex="1">
          <mxGeometry height="60" width="30" x="50" y="80" as="geometry" />
        </mxCell>
        <mxCell id="user-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="65" y="1900" as="sourcePoint" />
            <mxPoint x="65" y="140" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="frontend" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" value="Frontend" vertex="1">
          <mxGeometry height="40" width="100" x="140" y="80" as="geometry" />
        </mxCell>
        <mxCell id="frontend-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="190" y="1900" as="sourcePoint" />
            <mxPoint x="190" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pdf-routes" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="PDF Routes" vertex="1">
          <mxGeometry height="40" width="100" x="280" y="80" as="geometry" />
        </mxCell>
        <mxCell id="pdf-routes-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="330" y="1900" as="sourcePoint" />
            <mxPoint x="330" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pdf-service" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="PDF Service" vertex="1">
          <mxGeometry height="40" width="100" x="420" y="80" as="geometry" />
        </mxCell>
        <mxCell id="pdf-service-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="1900" as="sourcePoint" />
            <mxPoint x="470" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="chunking-svc" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" value="Chunking Svc" vertex="1">
          <mxGeometry height="40" width="100" x="560" y="80" as="geometry" />
        </mxCell>
        <mxCell id="chunking-svc-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="610" y="1900" as="sourcePoint" />
            <mxPoint x="610" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="doc-db" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Doc DB" vertex="1">
          <mxGeometry height="60" width="60" x="700" y="70" as="geometry" />
        </mxCell>
        <mxCell id="doc-db-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="730" y="1900" as="sourcePoint" />
            <mxPoint x="730" y="130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="weaviate" parent="1" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#e1d5e7;strokeColor=#9673a6;" value="Weaviate" vertex="1">
          <mxGeometry height="60" width="60" x="810" y="70" as="geometry" />
        </mxCell>
        <mxCell id="weaviate-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="840" y="1900" as="sourcePoint" />
            <mxPoint x="840" y="130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="openai" parent="1" style="ellipse;shape=cloud;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" value="OpenAI" vertex="1">
          <mxGeometry height="60" width="80" x="920" y="70" as="geometry" />
        </mxCell>
        <mxCell id="openai-line" edge="1" parent="1" style="endArrow=none;dashed=1;html=1;strokeColor=#666666;" value="">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="960" y="1900" as="sourcePoint" />
            <mxPoint x="960" y="130" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg1" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Select PDF">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="65" y="170" as="sourcePoint" />
            <mxPoint x="190" y="170" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg2" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="POST /pdf/parse-pdf">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="190" y="210" as="sourcePoint" />
            <mxPoint x="330" y="210" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg3" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Read file bytes">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="330" y="250" as="sourcePoint" />
            <mxPoint x="470" y="250" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg4" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Calculate hash">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="290" as="sourcePoint" />
            <mxPoint x="610" y="290" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg5" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Check duplicate">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="330" as="sourcePoint" />
            <mxPoint x="730" y="330" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg6" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="No duplicate">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="730" y="370" as="sourcePoint" />
            <mxPoint x="470" y="370" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg7" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Extract text/tables &amp; images">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="410" as="sourcePoint" />
            <mxPoint x="610" y="410" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg8" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Process text (1st pass)">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="450" as="sourcePoint" />
            <mxPoint x="960" y="450" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg9" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="Structured chunks">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="960" y="490" as="sourcePoint" />
            <mxPoint x="470" y="490" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg10" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Process images (2nd pass)">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="530" as="sourcePoint" />
            <mxPoint x="960" y="530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg11" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="Image descriptions">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="960" y="570" as="sourcePoint" />
            <mxPoint x="470" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg12" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Merge chunks">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="610" as="sourcePoint" />
            <mxPoint x="610" y="610" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg13" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="Chunks + metadata">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="610" y="650" as="sourcePoint" />
            <mxPoint x="330" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg14" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="200 OK: chunks[]">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="330" y="690" as="sourcePoint" />
            <mxPoint x="190" y="690" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg15" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="Display chunks">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="190" y="730" as="sourcePoint" />
            <mxPoint x="65" y="730" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg16" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Click &quot;Upload to KB&quot;">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="65" y="800" as="sourcePoint" />
            <mxPoint x="190" y="800" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg17" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="POST /kb/upload-to-kb">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="190" y="840" as="sourcePoint" />
            <mxPoint x="610" y="840" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg18" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Save document metadata">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="880" as="sourcePoint" />
            <mxPoint x="730" y="880" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg19" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Insert chunks with embeddings">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="470" y="920" as="sourcePoint" />
            <mxPoint x="840" y="920" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg20" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Generate embeddings">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="840" y="960" as="sourcePoint" />
            <mxPoint x="960" y="960" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg21" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="Success">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="840" y="1000" as="sourcePoint" />
            <mxPoint x="470" y="1000" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg22" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="200 OK: doc_id, action">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="610" y="1040" as="sourcePoint" />
            <mxPoint x="190" y="1040" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="msg23" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="Show success modal">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="190" y="1080" as="sourcePoint" />
            <mxPoint x="65" y="1080" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-box" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" value="" vertex="1">
          <mxGeometry height="120" width="300" x="50" y="1150" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" value="Legend" vertex="1">
          <mxGeometry height="20" width="60" x="60" y="1160" as="geometry" />
        </mxCell>
        <mxCell id="legend1" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;" value="Request →">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="70" y="1195" as="sourcePoint" />
            <mxPoint x="150" y="1195" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend2" edge="1" parent="1" style="endArrow=classic;html=1;strokeColor=#000000;dashed=1;" value="Response ←">
          <mxGeometry height="50" relative="1" width="50" as="geometry">
            <mxPoint x="150" y="1225" as="sourcePoint" />
            <mxPoint x="70" y="1225" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-text1" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" value="Synchronous call" vertex="1">
          <mxGeometry height="20" width="150" x="160" y="1185" as="geometry" />
        </mxCell>
        <mxCell id="legend-text2" parent="1" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11" value="Return/Response" vertex="1">
          <mxGeometry height="20" width="150" x="160" y="1215" as="geometry" />
        </mxCell>
        <mxCell id="note1" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#fff2cc;strokeColor=#d6b656;align=left;verticalAlign=top;fontSize=10" value="Two-Pass AI Processing:&#xa;1st Pass: Text chunks with GPT-4o&#xa;2nd Pass: Image descriptions" vertex="1">
          <mxGeometry height="70" width="180" x="1020" y="450" as="geometry" />
        </mxCell>
        <mxCell id="note2" parent="1" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;darkOpacity=0.05;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;verticalAlign=top;fontSize=10" value="Hybrid Search:&#xa;- Vector search (embeddings)&#xa;- BM25 keyword search&#xa;- OpenAI reranking" vertex="1">
          <mxGeometry height="70" width="170" x="1020" y="920" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
